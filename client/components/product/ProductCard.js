import React, { useEffect } from 'react';
import styles from './ProductCard.module.css';
import { useRouter } from 'next/navigation';

// 簡化的星星圖標組件 - 直接整合在 ProductCard.js 中
const StarIcon = ({ filled = false }) => {
  return (
    <svg
      width='14'
      height='15'
      viewBox='0 0 13 14'
      fill='none'
      xmlns='http://www.w3.org/2000/svg'
      className={`${styles.starIcon} ${
        filled ? styles.starFilled : styles.starEmpty
      }`}
    >
      <path d='M5.74753 1.56545C6.15115 0.608286 7.50752 0.608287 7.91114 1.56545L8.73649 3.52272C8.89563 3.90013 9.23997 4.16732 9.64508 4.22775L11.7676 4.54436C12.7022 4.68377 13.0976 5.8139 12.4537 6.50554L10.7221 8.36566C10.4747 8.63147 10.3641 8.99683 10.4228 9.35523L10.8299 11.843C10.9922 12.8353 9.91357 13.5592 9.0568 13.033L7.44378 12.0424C7.06686 11.8109 6.59182 11.8109 6.2149 12.0424L4.60188 13.033C3.74511 13.5592 2.66643 12.8353 2.8288 11.843L3.23589 9.35523C3.29454 8.99683 3.18403 8.63147 2.93658 8.36566L1.20494 6.50554C0.561086 5.8139 0.956462 4.68377 1.89106 4.54436L4.0136 4.22775C4.41871 4.16732 4.76304 3.90013 4.92219 3.52272L5.74753 1.56545Z' />
    </svg>
  );
};

// 簡化的評分顯示組件
const ProductRating = ({ rating = 0 }) => {
  // 使用 || 運算子提供預設值
  const safeRating = Number(rating || 0);

  return (
    <div className={styles.productRating}>
      <div className={styles.starsContainer}>
        {[...Array(5)].map((_, index) => (
          <StarIcon key={index} filled={index < Math.round(safeRating)} />
        ))}
      </div>
      <span className={styles.ratingNumber}>{safeRating.toFixed(1)}</span>
    </div>
  );
};

const ProductCard = ({
  product,
  onAddToCart,
  onAddToWishlist,
  className = '',
  isBookmarked
}) => {
  const router = useRouter();
  const handleProductClick = (productId) => {
    router.push(`/products/${productId}`);
  };

  const handleCartClick = (e) => {
    e.stopPropagation(); // 防止觸發父元素點擊
    if (onAddToCart) {
      onAddToCart(product);
    }
  };

  const handleWishlistClick = (e) => {
    e.stopPropagation(); // 防止觸發父元素點擊
    if (onAddToWishlist) {
      onAddToWishlist(product);
    }
  };
  useEffect

  return (
    <div
      className={`${styles.productCard} ${className}`}
      onClick={() => handleProductClick(product.id)}
      style={{ cursor: 'pointer' }}
    >
      {/* 商品圖片 */}
      <div className={styles.productImage}>
        <img src={product.pathname} alt={product.name} />
      </div>

      {/* 商品資訊 */}
      <div className={styles.productInfo}>
        {/* 專輯標題 */}
        <div className={styles.albumTitle}>{product.name}</div>

        {/* 評分區域 */}
        <div className={styles.ratingSection}>
          <ProductRating rating={product.average_rating} />
        </div>

        {/* 藝人名稱 */}
        <div className={styles.artistName}>{product.artist}</div>

        {/* 價格區域 */}
        <div className={styles.priceSection}>
          <div className={styles.price}>
            NT ${product.price.toLocaleString()}
          </div>
          <div className={styles.actionButtons}>
            <button
              className={styles.cartBtn}
              onClick={handleCartClick}
              aria-label='加入購物車'
            >
              <svg
                width='12'
                height='14'
                viewBox='0 0 12 14'
                fill='none'
                xmlns='http://www.w3.org/2000/svg'
              >
                <path
                  d='M11.9471 9.03738C11.9456 8.62966 11.8251 8.23178 11.6012 7.89516C11.3773 7.55855 11.0603 7.2987 10.6911 7.1492L11.9272 2.3948C11.9531 2.29354 11.9558 2.18752 11.9351 2.08502C11.9145 1.98252 11.8711 1.88631 11.8083 1.80389C11.7441 1.72667 11.6638 1.66523 11.5734 1.62409C11.4831 1.58295 11.3849 1.56316 11.2861 1.56617H2.23017L2.01204 0.710379C1.97411 0.565649 1.89066 0.437873 1.77469 0.346962C1.65871 0.256052 1.51672 0.207112 1.37086 0.20777H0.0488281V1.56617H0.861875L2.50119 7.85557C2.53992 8.00375 2.62634 8.13408 2.74637 8.22535C2.8664 8.31661 3.01297 8.36343 3.1622 8.35818H9.96403C10.1393 8.35818 10.3075 8.42974 10.4314 8.55711C10.5554 8.68449 10.625 8.85725 10.625 9.03738C10.625 9.21752 10.5554 9.39027 10.4314 9.51765C10.3075 9.64502 10.1393 9.71658 9.96403 9.71658H1.37086C1.19554 9.71658 1.02741 9.78814 0.903448 9.91551C0.779484 10.0429 0.709842 10.2156 0.709842 10.3958C0.709842 10.5759 0.779484 10.7487 0.903448 10.8761C1.02741 11.0034 1.19554 11.075 1.37086 11.075H2.15085C2.04214 11.3828 2.0072 11.7129 2.04901 12.0375C2.09081 12.3621 2.20812 12.6715 2.39101 12.9396C2.57389 13.2077 2.81696 13.4266 3.09964 13.5777C3.38231 13.7289 3.69626 13.8078 4.01491 13.8078C4.33355 13.8078 4.64751 13.7289 4.93018 13.5777C5.21285 13.4266 5.45592 13.2077 5.63881 12.9396C5.82169 12.6715 5.939 12.3621 5.98081 12.0375C6.02261 11.7129 5.98768 11.3828 5.87897 11.075H7.43896C7.34 11.3552 7.30208 11.6544 7.3279 11.9513C7.35372 12.2482 7.44264 12.5357 7.58838 12.7935C7.73412 13.0513 7.93314 13.2731 8.17139 13.4432C8.40964 13.6133 8.68132 13.7277 8.96727 13.7782C9.25322 13.8287 9.54646 13.814 9.82632 13.7354C10.1062 13.6567 10.3658 13.5159 10.5869 13.3229C10.8081 13.1299 10.9853 12.8894 11.1061 12.6183C11.2269 12.3473 11.2883 12.0523 11.2861 11.7542C11.2848 11.4033 11.1936 11.0589 11.0217 10.7558C11.3043 10.5726 11.5374 10.3191 11.6991 10.0187C11.8609 9.71828 11.9462 9.38072 11.9471 9.03738ZM9.36251 6.99978H3.6844L2.58712 2.92457H10.4267L9.36251 6.99978ZM4.01491 12.4334C3.88417 12.4334 3.75637 12.3936 3.64767 12.3189C3.53897 12.2443 3.45424 12.1382 3.40421 12.0141C3.35418 11.89 3.34109 11.7534 3.3666 11.6217C3.3921 11.4899 3.45506 11.3689 3.5475 11.2739C3.63995 11.1789 3.75773 11.1142 3.88595 11.088C4.01418 11.0618 4.14708 11.0753 4.26787 11.1267C4.38865 11.1781 4.49189 11.2651 4.56452 11.3768C4.63715 11.4885 4.67592 11.6199 4.67592 11.7542C4.67592 11.9343 4.60628 12.1071 4.48232 12.2345C4.35835 12.3618 4.19022 12.4334 4.01491 12.4334ZM9.30302 12.4334C9.17228 12.4334 9.04448 12.3936 8.93578 12.3189C8.82707 12.2443 8.74235 12.1382 8.69232 12.0141C8.64229 11.89 8.6292 11.7534 8.6547 11.6217C8.68021 11.4899 8.74317 11.3689 8.83561 11.2739C8.92805 11.1789 9.04583 11.1142 9.17406 11.088C9.30228 11.0618 9.43519 11.0753 9.55597 11.1267C9.67676 11.1781 9.78 11.2651 9.85263 11.3768C9.92526 11.4885 9.96403 11.6199 9.96403 11.7542C9.96403 11.9343 9.89439 12.1071 9.77042 12.2345C9.64646 12.3618 9.47833 12.4334 9.30302 12.4334Z'
                  fill='grey'
                />
              </svg>
            </button>
            <button
              className={`${styles.heartBtn} ${isBookmarked ? styles.bookmarked : ''}`}
              onClick={handleWishlistClick}
              aria-label='加入願望清單'
            >
              <svg
                width='13'
                height='15'
                viewBox='0 0 13 15'
                fill={isBookmarked ? "#E6C068" : "transparent"}
                xmlns='http://www.w3.org/2000/svg'
              >
                <path
                  d='M10.2217 0.667969L10.4199 0.677734C10.8808 0.723733 11.3128 0.92587 11.6416 1.25098C11.97 1.57578 12.1716 2.00052 12.2178 2.45117L12.2285 2.64648V12.4238C12.2288 12.5948 12.1803 12.7636 12.0889 12.9102C11.9976 13.0565 11.8665 13.1759 11.709 13.2539H11.708C11.5504 13.3318 11.3736 13.3654 11.1973 13.3496C11.021 13.3338 10.8532 13.2694 10.7129 13.165L10.7109 13.1641L7.39355 10.7061L7.39062 10.7041C7.18827 10.5557 6.94366 10.4756 6.69336 10.4756C6.44312 10.4757 6.19839 10.5557 5.99609 10.7041L5.99414 10.7061L2.67285 13.167C2.53224 13.2715 2.36404 13.3358 2.1875 13.3516C2.05515 13.3634 1.92248 13.3472 1.79785 13.3057L1.67578 13.2559C1.51798 13.1776 1.3863 13.0579 1.29492 12.9111C1.20362 12.7644 1.15581 12.5959 1.15625 12.4248V2.64648C1.15733 2.12449 1.36778 1.6223 1.74316 1.25098C2.07173 0.926106 2.50334 0.723887 2.96387 0.677734L3.16309 0.667969H10.2217Z'
                  stroke='#E6C068'
                  strokeWidth='1.3125'
                />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};
export { StarIcon };
export default ProductCard;
